language: java
jdk: oraclejdk12

sudo: required

services:
  - postgresql
  - docker

before_install:
  - psql -c 'create user csld with password '"'"'csld'"'"';' -U postgres
  - psql -c 'create database csld_dev with owner csld;' -U postgres
  - sudo apt-get -y install awscli

script:
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=CSLD_CSLD -B

branches:
  only:
    - master
    - dev

addons:
  sonarcloud:
    organization: "csld"
    token:
      secure: WYfCah03KZg6K/AzzJqAQQn8y6jCsK/MxZ4Fezlxx8YJ6Gk2ofQw/awfP4eGqysoPZgS3fLErExZbKAC00eDTjWhNcjSJEuyoCX6rzzwBnQn3fiVaAdNw0/WrMHV2c4RXWt6ecRFp7OxSFcRzLMRkJ0txYUrbj3cbeoIpsxnNwQ=

deploy:
  provider: heroku
  api_key:
    secure: H6x6EbY413IumsU/tupJQ3+fdBSCCv2bnBIq30SD6B9oymofZlt1C+EDH0mHRmdXvjY29jWTIardqpuQ8l+PrsfYS456AjGiBD6I8hmkQeW1rAzeHSQclahEHQxfkOpfPDyZ5BOGOcGQAhPHcVIP7dxvZd0eWETxK5gMEwR2nHk=
  app: larp-db-dev